---
import type { HTMLAttributes } from 'astro/types';
import Element from './Element.astro';
import Card from './Card.astro';

interface Props extends HTMLAttributes<'div'> {
  position?: 'left' | 'right' | undefined;
}

const { position = 'left', class: className, ...rest } = Astro.props as Props;
---

<Element as="z-dropdown" class:list="relative" newClassName={className} {...rest}>
  <slot name="trigger" />
  <Card
    class={`hidden absolute z-20 mt-2 w-max ${position === 'right' ? 'right-0' : 'left-0'} bg-flexoki-base-100 dark:bg-flexoki-base-900 border border-flexoki-base-100 dark:border-flexoki-base-900`}
  >
    <slot />
  </Card>
</Element>

<script>
  class Dropdown extends HTMLElement {
    constructor() {
      super();

      const dropdownButtonTrigger = this.children[0];
      const dropdownContent = this.children[1];

      dropdownButtonTrigger.addEventListener('click', () => {
        dropdownContent?.classList.toggle('hidden');
      });

      document.addEventListener('click', (event) => {
        if (
          !dropdownButtonTrigger.contains(event.target as Node) &&
          !dropdownContent?.contains(event.target as Node)
        ) {
          dropdownContent?.classList.add('hidden');
        }
      });
    }
  }

  customElements.define('z-dropdown', Dropdown);
</script>
